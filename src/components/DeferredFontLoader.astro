---
// Deferred font loader for accessibility panel fonts
// Loads OpenDyslexic and Fast Sans after initial page render to avoid blocking LCP
---

<script is:inline>
  // Defer font loading until after initial render
  if ('fonts' in document) {
    // Use CSS Font Loading API to load fonts asynchronously
    window.addEventListener('DOMContentLoaded', () => {
      // Small delay to ensure LCP has occurred
      setTimeout(() => {
        // Load OpenDyslexic
        const openDyslexic = new FontFace(
          'OpenDyslexic3',
          'url(/fonts/OpenDyslexic3-Regular.woff2) format("woff2"), url(/fonts/OpenDyslexic3-Regular.woff) format("woff"), url(/fonts/OpenDyslexic3-Regular.ttf) format("truetype")',
          {
            weight: '400',
            style: 'normal',
            display: 'swap',
          }
        );

        // Load Fast Sans
        const fastSans = new FontFace(
          'Fast Sans',
          'url(/fonts/Fast_Sans.woff2) format("woff2"), url(/fonts/Fast_Sans.woff) format("woff"), url(/fonts/Fast_Sans.ttf) format("truetype")',
          {
            weight: '400',
            style: 'normal',
            display: 'swap',
          }
        );

        // Load both fonts
        Promise.all([openDyslexic.load(), fastSans.load()])
          .then((fonts) => {
            fonts.forEach((font) => {
              document.fonts.add(font);
            });
            console.log('âœ“ Accessibility fonts loaded');
          })
          .catch((error) => {
            console.warn('Failed to load accessibility fonts:', error);
          });
      }, 100); // 100ms delay after DOMContentLoaded
    });
  } else {
    // Fallback for browsers without Font Loading API
    // Create a hidden element to trigger font load
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        const fallbackDiv = document.createElement('div');
        fallbackDiv.style.cssText = 'position:absolute;left:-9999px;top:-9999px;visibility:hidden;font-size:1px;';
        fallbackDiv.innerHTML = `
          <span style="font-family:'OpenDyslexic3'">.</span>
          <span style="font-family:'Fast Sans'">.</span>
        `;
        document.body.appendChild(fallbackDiv);
        // Remove after fonts are loaded (estimated)
        setTimeout(() => fallbackDiv.remove(), 2000);
      }, 100);
    });
  }
</script>
